{% extends '../base.html' %}

{% block title %}{{ employee.employeeID }} | Staff Login View{% endblock %}

{% block breadcrumb %}

<li class="breadcrumb-item active" aria-current="page">{{ employee.firstName }} {{ employee.lastName }}</li>
{% endblock %}

{% block content %}

<!-- Error message box will be shown only if the msg variable has some value -->
{% if msg != "" %}
<div class="row">
        <div class="col-md-12 col-sm-12">
            <!-- Checking whether it is a danger type or info type needed for the box
                Will be checked by mtype is d or i
            -->
            {% if mtype == "d" or mtype == "a" %}
            <div class="alert alert-danger">
            {% elif mtype == "i" %}
            <div class="alert alert-info">
            {% endif %}
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                {% if mtype == "a" %}
                    {% for key, values in msg %}
                        <p>{{ key }} : {{ values.0 }}</p>
                    {% endfor %}
                {% else %}
                    <p>{{ msg }}</p>
                {% endif %}
            </div>
        </div>
</div>    
{% endif %}

        {% csrf_token %}
        <div class="container">
                <div class="row">
                        <div class="col-md-12 text-center">
                            <h2>Employee: {{ employee.firstName }} {{ employee.lastName }}</h2>
                            <hr>
                        </div>
                </div>
            <div class="row">

            <div class="col-md-6">
                    <h5>Personal Details</h5>
                    <hr>
                    <br>
                                <div class="row">
                                    <div class="col-md-3 field-label-responsive">
                                        <label for="firstName">First Name</label>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <div class="input-group mb-2 mr-sm-2 mb-sm-0">
                                                <div class="input-group-addon" ></i></div>
                                                <input type="text" name="firstName" class="form-control" id="firstName"
                                                       placeholder="First Name" readonly="true" value="{{ employee.firstName }}">
                                            </div>
                                        </div>
                                    </div>
                                 
                                </div>
                                <div class="row">
                                    <div class="col-md-3 field-label-responsive">
                                        <label for="lastName">Last Name</label>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <div class="input-group mb-2 mr-sm-2 mb-sm-0">
                                                <div class="input-group-addon" ></i></div>
                                                <input type="text" name="lastName" class="form-control" id="lastName"
                                                       placeholder="Last Name" readonly="true" value="{{ employee.lastName }}">
                                            </div>
                                        </div>
                                    </div>
                                  
                                </div>
                                
                                <div class="row mt-5">
                                    <div class="col-md-3 field-label-responsive">
                                        <label for="DOB">Date Of Birth</label>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <div class="input-group mb-2 mr-sm-2 mb-sm-0">
                                                <div class="input-group-addon" ></i></div>
                                                <!-- <input type="text" name="DOB" class="form-control" id="DOB"
                                                       placeholder="date of Birth" required autofocus> -->
                                                    <input data-date-format="yyyy-mm-dd" name="dob" class="form-control"
                                                    id="datepicker" placeholder="yyyy-mm-dd" readonly="true" value="{{ employee.DOB }}">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3 field-label-responsive">
                                        <label for="TFN">TFN</label>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <div class="input-group mb-2 mr-sm-2 mb-sm-0">
                                                <div class="input-group-addon" ></i></div>
                                                <input type="text" name="TFN" class="form-control" id="TFN"
                                                       placeholder="TFN" readonly="true" value="{{ employee.TFN }}">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3 field-label-responsive">
                                        <label for="phoneNumber">Phone Number</label>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <div class="input-group mb-2 mr-sm-2 mb-sm-0">
                                                <div class="input-group-addon"></i></div>
                                                <input type="text" name="phoneNumber" class="form-control" id="phoneNumber"
                                                       placeholder="Phone Number" readonly="true" value="{{ employee.phoneNumber }}">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3 field-label-responsive">
                                        <label for="email">Email Address</label>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <div class="input-group mb-2 mr-sm-2 mb-sm-0">
                                                <div class="input-group-addon"></i></div>
                                                <input type="email" name="email" class="form-control" id="email"
                                                       placeholder="you@example.com" readonly="true" value="{{ employee.email }}">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row pt-4 pl-2">
                                        <h5>Address</h5>
                                        <hr>
                                        <br>
                                        <div class="col-md-12 pt-2">
                                            <div class="row">
                                                    <div class="col-md-3 field-label-responsive">
                                                            <label for="streetAddress">Street Address</label>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <div class="input-group mb-2 mr-sm-2 mb-sm-0">
                                                                    <div class="input-group-addon" ></i></div>
                                                                    <input type="text" name="streetAddress" class="form-control" id="streetAddress"
                                                                           placeholder="Street" readonly="true" value="{{ employee.streetAddress }}">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-3 field-label-responsive">
                                                            <label for="city">City</label>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <div class="input-group mb-2 mr-sm-2 mb-sm-0">
                                                                    <div class="input-group-addon" ></i></div>
                                                                    <input type="text" name="city" class="form-control" id="city"
                                                                           placeholder="City" readonly="true" value="{{ employee.cityAddress }}">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-3 field-label-responsive">
                                                            <label for="postalCode">Postal Code</label>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <div class="input-group mb-2 mr-sm-2 mb-sm-0">
                                                                    <div class="input-group-addon" ></i></div>
                                                                    <input type="text" name="postalCode" class="form-control" id="postalCode"
                                                                           placeholder="Postal Code" readonly="true" value="{{ employee.postCodeAddress }}">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-3 field-label-responsive">
                                                            <label for="state">State</label>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <div class="input-group mb-2 mr-sm-2 mb-sm-0">
                                                                    <div class="input-group-addon" ></i></div>
                                                                    <input type="text" name="postalCode" class="form-control" id="state"
                                                                           placeholder="Sate" readonly="true" value="{{ employee.stateAddress }}">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                        </div>
                                    </div>



                    </div>
                    <div class="col-md-6">
                        
                        <form action="/management/staff/createlogin" method="post">
	                    {% csrf_token %}
                            <h5>Login Details</h5>
                            <hr>
                            <br>
                            
                                {% if employee.disable != 1 %}
                                <div class="row">
                                    <div class="col-md-3 field-label-responsive">
                                        <label for="userType">Username</label>
                                    </div>
                                    <div class="col-md-6">
                                            <div class="form-group has-success">
                                                    <div class="input-group mb-2 mr-sm-2 mb-sm-0">
                                                        <div class="input-group-addon"></i></div>
                                                        <input type="text" class="form-control" id="uname"
                                                               placeholder="The username" name="username" readonly="readonly" value="">
                                                    </div>
                                                </div>
                                    </div>
                                </div>
                                <div class="row">
                                        <div class="col-md-3 field-label-responsive">
                                            <label for="userType">Password</label>
                                        </div>
                                        <div class="col-md-6">
                                                <div class="form-group">
                                                        <div class="input-group mb-2 mr-sm-2 mb-sm-0">
                                                            <div class="input-group-addon"></i></div>
                                                            <input type="text" class="form-control" id="pw"
                                                                   placeholder="The password" name="password" readonly="true" value="">
                                                        </div>
                                                    </div>
                                        </div>
                                    </div>
                                        <input type="hidden" name="empID" value="{{ employee.employeeID }}"/>
                                        <div class="row text-center pt-3 pl-5">
                                            <button type="submit" name="create" class="btn btn-flat btn-success">Create Login</button>
                                            <div class="ml-2 btn btn-flat btn-danger" id="disableBtn">Disable Account</div>
                                        </div>

                                        <br>
                                        <hr>
                                        <br>
                                    </form>
                                {% else %}
                                <div class="row">
                                    <div class="col-md-12 p-3 field-label-responsive">
                                        <label for="userType" class="pl-3">The account is currently disabled</label>
                                    </div>
                                </div>
                                    
                                    <div class="row text-center pt-3 pl-5 mb-5">
                                        <div class="ml-5 btn btn-flat btn-warning" id="enableBtn">Enable Account</div>
                                    </div>

                                {% endif %}
                            <h5>Store Details</h5>
                            <hr>
                            <br>
                            <div class="row">
                                    <div class="col-md-3 field-label-responsive">
                                        <label for="userType">Store</label>
                                    </div>
                                    <div class="col-md-6">
                                            <div class="form-group">
                                                    <div class="input-group mb-2 mr-sm-2 mb-sm-0">
                                                        <div class="input-group-addon"></i></div>
                                                        <input type="text" class="form-control" id="store"
                                                               placeholder="Store" readonly="true" value="{{ store.storeName }}">
                                                    </div>
                                                </div>
                                    </div>
                                </div>
                                <div class="row">
                                        <div class="col-md-3 field-label-responsive">
                                            <label for="userType">User Type</label>
                                        </div>
                                        <div class="col-md-6">
                                                <div class="form-group">
                                                        <div class="input-group mb-2 mr-sm-2 mb-sm-0">
                                                            <div class="input-group-addon"></i></div>
                                                            <input type="text" class="form-control" id="userType"
                                                                   placeholder="The User type" readonly="true" value="{{ employee.userType }}">
                                                        </div>
                                                    </div>
                                        </div>
                                    </div>
                    </div>
                    
            </div>
            </div>
  


{% endblock %}

{% block scripts %}
<script type="text/javascript">

    function generatePW(length){
        var text = "";
        var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789$()_";

        for (var i = 0; i < length; i++){
          text += possible.charAt(Math.floor(Math.random() * possible.length));
        }
        return text;
    }

    $(document).ready(function() {
        // getting the initials of the store name to add to the username
        var store = $("#store").val();
        var sa = store.split(" ");
        store = "";
        for(var i=0; i< sa.length; i++){
            store += sa[i].charAt(0).toLowerCase();
        }
        // will get the store initials trim the word
        // first name lower case and trim the word
        // last name first letter and to lower case
        var uname = store.trim()+$("#firstName").val().toLowerCase().trim()+$("#lastName").val().charAt(0).toLowerCase().trim();
        $.ajax({
                url: "/management/staff/usernames/list",
                type : 'POST', 
                success: function(result){
                    // converting the result string to JSON array
                    var result = JSON.parse(result);
                    for(var i=0; i< result.length; i++){
                        if(uname == result[i]['fields']['userName']){
                            uname += "1"
                        }
                    }
                    $("#uname").val(uname);
                }});
            
        $("#pw").val(generatePW(12));

       
    });

    $("#disableBtn").click(function(e){
        e.preventDefault();
        $.ajax({
                url: "/management/staff/activity/disable/{{ employee.employeeID }}",
                type : 'GET',
                success: function(result){
                    
                    window.location.replace("/management/staff/login/{{ employee.employeeID }}");
                }});
            
    })

    $("#enableBtn").click(function(e){
        e.preventDefault();
        $.ajax({
                url: "/management/staff/activity/enable/{{ employee.employeeID }}",
                type : 'GET',
                success: function(result){
                    window.location.replace("/management/staff/login/{{ employee.employeeID }}");
                }});
            
    })
</script>


{% endblock %}