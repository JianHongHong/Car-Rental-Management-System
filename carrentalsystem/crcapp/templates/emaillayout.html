{% extends 'base.html' %}

{% block title %}Email{% endblock %}

{% block breadcrumb %}

<li class="breadcrumb-item active" aria-current="page">Email</li>
{% endblock %}

{% block content %}

<!-- Error message box will be shown only if the msg variable has some value -->
{% if msg != "" %}
<div class="row">
        <div class="col-md-12 col-sm-12">
            <!-- Checking whether it is a danger type or info type needed for the box
                Will be checked by mtype is d or i
            -->
            {% if mtype == "d" or mtype == "a" %}
            <div class="alert alert-danger">
            {% elif mtype == "i" %}
            <div class="alert alert-info">
            {% endif %}
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                {% if mtype == "a" %}
                    {% for key, values in msg %}
                        <p>{{ key }} : {{ values.0 }}</p>
                    {% endfor %}
                {% else %}
                    <p>{{ msg }}</p>
                {% endif %}
            </div>
        </div>
</div>    
{% endif %}

    <div class="row">
        <div class="col-2">
                <div class="btn btn-flat btn-primary mb-2" id="genPDF">
                        Generate PDF
                    </div>
        </div>
        <div class="col-2">
                <div class="btn btn-flat btn-primary mb-2 disabled" id="sendEmail">
                        Email
                    </div>
        </div>
        
        <div class="col-md-12 p-5 border-blue border-5" id="emailComponent" style="position:relative;">
            <br>
            <br>
                <h1 class="font-blue text-center">Car Rental System</h1>
            <br>
            <br>
            <hr>
            <br>
            <div class="row justify-content-end mt-3 mb-3">
                <div class="col-md-4">
                        <p class="text-right">Date: {{ date }}</p>
                </div>
                
            </div>

            <div class="row p-4" style="min-height: 550px;">
                <div class="row">
                        <h4 class="ml-2">{{ msgemail.subject }}</h4>
                 
                </div>
                <div class="row">
                    
                    <p class="ml-2">
                        
                    Hello {{ item.firstName }}!<br>
                    </p>
                    <p> 
                            {{ msgemail.message | safe }}
                    </p>         
                    
                </div>

            </div>
            
            <div class="row" id="btmComponent" style="position: absolute; bottom: 60px;">
                <hr>
                <br>
                <div class="col-md-4">

                </div>
                <div class="col-md-4">
                    
                <p class="text-center">Generated by SE7EN | CRC System</p>
                </div>
                <div class="col-md-4">
                        <small>This information is copyright and confidential to Car Rental System and cannot use without obtaining prior permission.</small>
                </div>


            </div>
        </div>


    </div>


{% endblock %}

{% block scripts %}


<script type="text/javascript">
    var specialElementHandlers = {
            '#ignoreContent': function (element, renderer) {
                return true;
                }

        };
    $(document).ready(function() {
        // Making the div to have same ratio as an A4 sheet
        var width = $("#emailComponent").width();
  
        $("#emailComponent").height((width / 70.0) *  99 );  

        $('#genPDF').click(function () {   
            html2canvas($("#emailComponent"),{
                onrendered: function(canvas){
                    var img = canvas.toDataURL('image/png'); // saving the html component as png
                    // Adding the image to a pdf
                    var doc = new jsPDF('p','mm', 'a4');
                    var width = doc.internal.pageSize.width;    
                    var height = doc.internal.pageSize.height;
                    doc.addImage(img, 'JPEG', 0, 0, width, height);
                    doc.save('{{ item.firstName }}{{ date_un }}.pdf'); //pdf name
            }
            
        });
    });
        
    });
</script>


{% endblock %}